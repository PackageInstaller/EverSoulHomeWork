# ğŸ® EverSoul æ”»ç•¥ä½œä¸šåˆ†äº«ç«™

ä¸€ä¸ªåŸºäº Next.js 14 + TypeScript + Prisma æ„å»ºçš„ EverSoul æ¸¸æˆæ”»ç•¥åˆ†äº«å¹³å°ï¼Œæ”¯æŒç©å®¶ä¸Šä¼ é€šå…³æˆªå›¾ã€ç®¡ç†å‘˜å®¡æ ¸ã€å¤šæ•°æ®æºåˆ‡æ¢ç­‰åŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

- **ğŸ“Š å…³å¡æ•°æ®å±•ç¤º**

  - æ”¯æŒæ­£å¼æœ/æµ‹è¯•æœæ•°æ®æºåˆ‡æ¢
  - è¯¦ç»†çš„å…³å¡ä¿¡æ¯ï¼ˆæ•Œæ–¹é˜µå®¹ã€æˆ˜åŠ›ã€æ‰è½ç‡ç­‰ï¼‰
  - å“åº”å¼å…³å¡åˆ—è¡¨å’Œç« èŠ‚å¯¼èˆª
  - å…³å¡ä¸“å±èƒŒæ™¯å›¾ç‰‡ç³»ç»Ÿ
- **ğŸ“¤ ä½œä¸šä¸Šä¼ ç³»ç»Ÿ**

  - ç”¨æˆ·å‹å¥½çš„ä½œä¸šä¸Šä¼ ç•Œé¢
  - å›¾ç‰‡è‡ªåŠ¨å‹ç¼©ä¼˜åŒ–ï¼ˆSharpï¼‰
  - æ”¯æŒå¤šå›¾ç‰‡ä¸Šä¼ ï¼ˆæ ¹æ®é˜Ÿä¼æ•°é‡è‡ªåŠ¨è°ƒæ•´ï¼‰
  - è¾“å…¥å†…å®¹å®‰å…¨è¿‡æ»¤
- **ğŸ›¡ï¸ ç®¡ç†å‘˜å®¡æ ¸ç³»ç»Ÿ**

  - å®‰å…¨çš„å¯†ç è®¤è¯æœºåˆ¶
  - ä½œä¸šçŠ¶æ€ç®¡ç†ï¼ˆå¾…å®¡æ ¸/é€šè¿‡/æ‹’ç»ï¼‰
  - æ‰¹é‡é€‰æ‹©å’Œæ‰¹é‡æ“ä½œï¼ˆé€šè¿‡/æ‹’ç»/åˆ é™¤ï¼‰
  - åˆ†é¡µå±•ç¤ºå’Œæ™ºèƒ½ç­›é€‰
  - æ–‡ä»¶ç³»ç»Ÿè‡ªåŠ¨æ¸…ç†
  - å›¾ç‰‡é¢„è§ˆä¼˜åŒ–ï¼ˆå…³é—­æŒ‰é’®ä½äºå³ä¸Šè§’ï¼‰
- **ğŸ’ ç§¯åˆ†æ’è¡Œæ¦œç³»ç»Ÿ**

  - æœˆåº¦ç§¯åˆ†ç»Ÿè®¡å’Œæ’è¡Œ
  - 19å›¾åŠä»¥ä¸Šå…³å¡ç§¯åˆ†å¥–åŠ±
  - è‡ªåŠ¨ç§¯åˆ†è®¡ç®—ï¼ˆå•é˜Ÿ0.1åˆ†ï¼ŒåŒé˜Ÿ0.5åˆ†ï¼Œä¸‰é˜Ÿ1åˆ†ï¼‰
  - å·²æœ‰ä½œä¸šå›¾è‡ªåŠ¨å‡åŠç§¯åˆ†
  - æœˆåº¦å¥–æ± ç®¡ç†ï¼ˆåŸºç¡€200å…ƒ + ç´¯åŠ æœºåˆ¶ï¼‰
  - ä¸‰ç§å¥–åŠ±å‘æ”¾è§„åˆ™ï¼ˆ1:1å‘æ”¾æˆ–æŒ‰æ¯”ä¾‹åˆ†é…ï¼‰
  - è‡ªåŠ¨ç»“ç®—é…ç½®ï¼ˆæ”¯æŒå®šæ—¶ä»»åŠ¡ï¼‰
  - ç»“ç®—å†å²æŸ¥è¯¢å’Œå–æ¶ˆç»“ç®—
  - ç©å®¶ä½œä¸šè¯¦æƒ…æŸ¥çœ‹ï¼ˆç‚¹å‡»æ˜µç§°æŸ¥çœ‹æ‰€æœ‰ä½œä¸šï¼‰
- **ğŸ¨ ç”¨æˆ·ä½“éªŒ**

  - ç°ä»£åŒ– UI è®¾è®¡ï¼ˆTailwind CSSï¼‰
  - æš—è‰²ä¸»é¢˜é…è‰²æ–¹æ¡ˆ + ç²¾ç¾èƒŒæ™¯å›¾
  - æ¯›ç»ç’ƒæ•ˆæœå’ŒåŠ¨ç”»äº¤äº’
  - ç§»åŠ¨ç«¯å“åº”å¼é€‚é…
  - å¿«æ·å¯¼èˆªï¼ˆè¿”å›ä¸»é¡µæŒ‰é’®ï¼‰
  - ç©å®¶ä½œä¸šå¡ç‰‡å±•ç¤ºå’Œå¿«é€Ÿè·³è½¬



## ğŸš€ æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯

- **æ¡†æ¶**: Next.js 14 (App Router)
- **è¯­è¨€**: TypeScript 5
- **æ ·å¼**: Tailwind CSS 3
- **UI ç»„ä»¶**: Lucide React (å›¾æ ‡)
- **çŠ¶æ€ç®¡ç†**: React Hooks

### åç«¯æŠ€æœ¯

- **è¿è¡Œæ—¶**: Node.js
- **æ¡†æ¶**: Next.js API Routes
- **æ•°æ®åº“**: SQLite (Prisma ORM)
- **è®¤è¯**: è‡ªå®šä¹‰ JWT ä¼šè¯
- **æ–‡ä»¶å¤„ç†**: Sharp (å›¾ç‰‡å‹ç¼©)

### å¼€å‘å·¥å…·

- **ä»£ç è´¨é‡**: ESLint + TypeScript
- **åŒ…ç®¡ç†**: npm
- **æ•°æ®åº“è¿ç§»**: Prisma
- **æ„å»ºå·¥å…·**: Next.js å†…ç½®

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js 24+
- npm 11+

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**

```bash
git clone https://github.com/PackageInstaller/EverSoulHomeWork
cd EverSoulHomeWork
```

2. **å®‰è£…ä¾èµ–**

```bash
npm install
npm run build
```

3. **æ•°æ®åº“è®¾ç½®**

```bash
# ç”Ÿæˆ Prisma å®¢æˆ·ç«¯
npx prisma generate

# åˆ›å»ºæ•°æ®åº“å’Œè¡¨ç»“æ„
npx prisma db push
```

4. **é…ç½®ç®¡ç†å‘˜å¯†ç **

```bash
# åˆ›å»ºå¯†ç æ–‡ä»¶
echo "your_admin_password" > admin-secret.txt
```

5. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**

```bash
npm run dev
```

è®¿é—® [http://localhost:3000](http://localhost:3000) æŸ¥çœ‹åº”ç”¨ã€‚

### ç”Ÿäº§éƒ¨ç½²

```bash
# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm run start
# æˆ–è€…æ¨èpm2å¯åŠ¨
npm intall pm2
pm2 start npm -- start
```

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
EverSoulHomeWork/
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma          # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ dev.db                 # SQLite æ•°æ®åº“
â”‚   â””â”€â”€ migrations/            # æ•°æ®åº“è¿ç§»è®°å½•
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ images/               # é™æ€å›¾ç‰‡èµ„æº
â”‚   â”‚   â”œâ”€â”€ bg_worldmap.webp           # ä¸–ç•Œåœ°å›¾èƒŒæ™¯
â”‚   â”‚   â”œâ”€â”€ MS02_GoldenMinister.webp   # æ’è¡Œæ¦œèƒŒæ™¯
â”‚   â”‚   â””â”€â”€ main_story/                # ä¸»çº¿å…³å¡èƒŒæ™¯å›¾
â”‚   â””â”€â”€ uploads/homework/     # ç”¨æˆ·ä¸Šä¼ çš„ä½œä¸šå›¾ç‰‡
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                  # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ api/             # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/       # ç®¡ç†å‘˜ API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth/           # è®¤è¯æ¥å£
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ homework/       # ä½œä¸šç®¡ç†æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ cache/       # æ•°æ®ç¼“å­˜ API
â”‚   â”‚   â”‚   â”œâ”€â”€ homework/    # ä½œä¸šç›¸å…³ API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ [stageId]/      # è·å–å…³å¡ä½œä¸š
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ by-user/        # è·å–ç©å®¶ä½œä¸šï¼ˆv1.2.0ï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ upload/         # ä¸Šä¼ ä½œä¸š
â”‚   â”‚   â”‚   â””â”€â”€ points/      # ç§¯åˆ†ç³»ç»Ÿ APIï¼ˆv1.0.0ï¼‰
â”‚   â”‚   â”‚       â”œâ”€â”€ leaderboard/           # æ’è¡Œæ¦œ
â”‚   â”‚   â”‚       â”œâ”€â”€ settle/                # æœˆåº¦ç»“ç®—
â”‚   â”‚   â”‚       â”œâ”€â”€ cancel-settlement/     # å–æ¶ˆç»“ç®—ï¼ˆv1.1.0ï¼‰
â”‚   â”‚   â”‚       â”œâ”€â”€ auto-settlement-config/# è‡ªåŠ¨ç»“ç®—é…ç½®ï¼ˆv1.1.0ï¼‰
â”‚   â”‚   â”‚       â”œâ”€â”€ auto-settlement-trigger/# è§¦å‘è‡ªåŠ¨ç»“ç®—
â”‚   â”‚   â”‚       â”œâ”€â”€ history/               # ç§¯åˆ†å†å²
â”‚   â”‚   â”‚       â””â”€â”€ months/                # æœˆä»½åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ admin/           # ç®¡ç†å‘˜é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ cache/       # ç¼“å­˜ç®¡ç†å­é¡µé¢
â”‚   â”‚   â”œâ”€â”€ stage/           # å…³å¡ç›¸å…³é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ [id]/        # å…³å¡è¯¦æƒ…é¡µ
â”‚   â”‚   â”œâ”€â”€ leaderboard/     # æ’è¡Œæ¦œé¡µé¢ï¼ˆv1.0.0ï¼‰
â”‚   â”‚   â””â”€â”€ globals.css      # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ components/          # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ CacheManagement.tsx      # ç¼“å­˜ç®¡ç†ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ HomeworkSection.tsx      # ä½œä¸šå±•ç¤ºç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ HomeworkUpload.tsx       # ä½œä¸šä¸Šä¼ ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ PointsLeaderboard.tsx    # æ’è¡Œæ¦œç»„ä»¶ï¼ˆv1.0.0ï¼‰
â”‚   â”‚   â”œâ”€â”€ PointsSettlement.tsx     # ç»“ç®—ç®¡ç†ç»„ä»¶ï¼ˆv1.1.0ï¼‰
â”‚   â”‚   â”œâ”€â”€ UserHomeworkModal.tsx    # ç©å®¶ä½œä¸šè¯¦æƒ…å¼¹çª—ï¼ˆv1.2.0ï¼‰
â”‚   â”‚   â”œâ”€â”€ StageDetails.tsx         # å…³å¡è¯¦æƒ…ç»„ä»¶
â”‚   â”‚   â””â”€â”€ StageListContent.tsx     # å…³å¡åˆ—è¡¨ç»„ä»¶
â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ lib/                # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ prisma.ts                # Prisma å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ pointsCalculator.ts      # ç§¯åˆ†è®¡ç®—é€»è¾‘ï¼ˆv1.0.0ï¼‰
â”‚   â”‚   â””â”€â”€ startup.ts               # å¯åŠ¨åˆå§‹åŒ–
â”‚   â”œâ”€â”€ types/              # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ backgroundUtils.ts       # èƒŒæ™¯å›¾ç‰‡å·¥å…·
â”‚       â””â”€â”€ dataUtils.ts             # æ•°æ®å¤„ç†å·¥å…·
â”œâ”€â”€ scripts/                # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ check-db.js                  # æ•°æ®åº“æ£€æŸ¥
â”‚   â”œâ”€â”€ init-cache.js                # ç¼“å­˜åˆå§‹åŒ–
â”‚   â””â”€â”€ vacuum-db.js                 # æ•°æ®åº“æ¸…ç†
â”œâ”€â”€ admin-secret.txt        # ç®¡ç†å‘˜å¯†ç ï¼ˆéœ€è¦åˆ›å»ºï¼‰
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸ”Œ API æ¥å£æ–‡æ¡£

### ä½œä¸šç›¸å…³æ¥å£

#### è·å–å…³å¡ä½œä¸š

```http
GET /api/homework/[stageId]
```

- **å‚æ•°**: `stageId` - å…³å¡IDï¼ˆå¦‚ "1-1"ï¼‰
- **è¿”å›**: å·²å®¡æ ¸é€šè¿‡çš„ä½œä¸šåˆ—è¡¨

#### è·å–ç©å®¶ä½œä¸šåˆ—è¡¨ï¼ˆæ–°å¢ v1.2.0ï¼‰

```http
GET /api/homework/by-user?nickname=ç©å®¶æ˜µç§°&page=1&limit=50
```

- **å‚æ•°**:
  - `nickname`: ç©å®¶æ˜µç§°ï¼ˆå¿…éœ€ï¼‰
  - `page`: é¡µç ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼‰
  - `limit`: æ¯é¡µæ•°é‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤20ï¼‰
- **è¿”å›**: ç©å®¶æ‰€æœ‰å·²å®¡æ ¸é€šè¿‡çš„ä½œä¸šåˆ—è¡¨ï¼ŒåŒ…å«åŒºåŸŸåˆ†å¸ƒç»Ÿè®¡

#### ä¸Šä¼ ä½œä¸š

```http
POST /api/homework/upload
```

- **Content-Type**: `multipart/form-data`
- **å‚æ•°**:
  - `stageId`: å…³å¡ID
  - `nickname`: ç”¨æˆ·æ˜µç§°
  - `description`: ä½œä¸šæè¿°ï¼ˆå¯é€‰ï¼‰
  - `teamCount`: é˜Ÿä¼æ•°é‡
  - `images`: å›¾ç‰‡æ–‡ä»¶æ•°ç»„

### ç®¡ç†å‘˜æ¥å£

#### ç®¡ç†å‘˜è®¤è¯

```http
POST /api/admin/auth      # ç™»å½•
GET /api/admin/auth       # éªŒè¯ä¼šè¯
DELETE /api/admin/auth    # ç™»å‡º
```

#### ä½œä¸šç®¡ç†

```http
GET /api/admin/homework                    # è·å–ä½œä¸šåˆ—è¡¨ï¼ˆæ”¯æŒç­›é€‰å’Œåˆ†é¡µï¼‰
PATCH /api/admin/homework/[id]            # æ›´æ–°ä½œä¸šçŠ¶æ€ï¼ˆè‡ªåŠ¨è®¡ç®—ç§¯åˆ†ï¼‰
DELETE /api/admin/homework/[id]           # åˆ é™¤ä½œä¸š
```

### ç§¯åˆ†æ’è¡Œæ¦œæ¥å£ï¼ˆæ–°å¢ v1.0.0ï¼‰

#### è·å–æ’è¡Œæ¦œ

```http
GET /api/points/leaderboard?yearMonth=2025-10
```

- **å‚æ•°**: `yearMonth` - å¹´æœˆï¼ˆå¯é€‰ï¼Œé»˜è®¤å½“å‰æœˆï¼‰
- **è¿”å›**: æ’è¡Œæ¦œæ•°æ®ã€å¥–æ± ä¿¡æ¯ã€é¢„ä¼°å¥–åŠ±

#### è·å–æœˆä»½åˆ—è¡¨

```http
GET /api/points/months
```

- **è¿”å›**: æ‰€æœ‰æœ‰ç§¯åˆ†è®°å½•çš„æœˆä»½åˆ—è¡¨

#### è·å–ç§¯åˆ†å†å²

```http
GET /api/points/history?nickname=ç©å®¶æ˜µç§°
```

- **å‚æ•°**: `nickname` - ç©å®¶æ˜µç§°
- **è¿”å›**: ç©å®¶çš„ç§¯åˆ†è·å–å†å²ï¼ˆæœ€å¤š50æ¡ï¼‰

#### æ‰§è¡Œæœˆåº¦ç»“ç®—ï¼ˆç®¡ç†å‘˜ï¼‰

```http
POST /api/points/settle
Content-Type: application/json

{
  "yearMonth": "2025-10"
}
```

- **æƒé™**: éœ€è¦ç®¡ç†å‘˜ç™»å½•
- **è¿”å›**: ç»“ç®—ç»“æœå’Œå¥–åŠ±æ˜ç»†

#### å–æ¶ˆç»“ç®—ï¼ˆç®¡ç†å‘˜ï¼Œv1.1.0ï¼‰

```http
POST /api/points/cancel-settlement
Content-Type: application/json

{
  "yearMonth": "2025-10"
}
```

- **æƒé™**: éœ€è¦ç®¡ç†å‘˜ç™»å½•
- **åŠŸèƒ½**: å–æ¶ˆæŒ‡å®šæœˆä»½çš„ç»“ç®—

#### è‡ªåŠ¨ç»“ç®—é…ç½®ï¼ˆç®¡ç†å‘˜ï¼Œv1.1.0ï¼‰

```http
GET /api/points/auto-settlement-config           # è·å–é…ç½®
POST /api/points/auto-settlement-config          # æ›´æ–°é…ç½®

# POST è¯·æ±‚ä½“ç¤ºä¾‹
{
  "enabled": true,
  "dayOfMonth": 1,
  "hour": 0,
  "minute": 0
}
```

#### è§¦å‘è‡ªåŠ¨ç»“ç®—ï¼ˆå®šæ—¶ä»»åŠ¡ï¼Œå…¼å®¹æ¥å£ï¼‰

```http
POST /api/points/auto-settlement-trigger
```

- **ç”¨é€”**: å…¼å®¹å¤–éƒ¨å®šæ—¶ä»»åŠ¡è°ƒç”¨ï¼ˆå¦‚ Cronã€GitHub Actionsï¼‰
- **åŠŸèƒ½**: æ£€æŸ¥é…ç½®å¹¶æ‰§è¡Œè‡ªåŠ¨ç»“ç®—
- **è¯´æ˜**: v1.2.3åå·²å†…ç½®è‡ªåŠ¨æœåŠ¡ï¼Œæ­¤æ¥å£ä¿ç•™ç”¨äºå…¼å®¹æ€§

#### è‡ªåŠ¨ç»“ç®—æœåŠ¡çŠ¶æ€ï¼ˆv1.2.3ï¼‰

```http
GET /api/points/auto-settlement-status
```

- **æƒé™**: éœ€è¦ç®¡ç†å‘˜ç™»å½•
- **åŠŸèƒ½**: æŸ¥çœ‹è‡ªåŠ¨ç»“ç®—æœåŠ¡è¿è¡ŒçŠ¶æ€å’ŒæœåŠ¡å™¨æ—¶é—´

#### åŸºç¡€å¥–æ± é…ç½®ï¼ˆç®¡ç†å‘˜ï¼Œv1.2.2ï¼‰

```http
GET /api/points/base-pool                        # è·å–åŸºç¡€å¥–æ± é…ç½®
POST /api/points/base-pool                       # æ›´æ–°åŸºç¡€å¥–æ± é…ç½®

# POST è¯·æ±‚ä½“ç¤ºä¾‹
{
  "basePool": 200
}
```

- **æƒé™**: POSTéœ€è¦ç®¡ç†å‘˜ç™»å½•
- **åŠŸèƒ½**: é…ç½®æ¯æœˆåŸºç¡€å¥–æ± é‡‘é¢ï¼ˆé»˜è®¤200å…ƒï¼‰

### CDN ç¼“å­˜é…ç½®

**éœ€è¦ç¦ç”¨ç¼“å­˜çš„æ¥å£**:

- `/api/admin/*` - æ‰€æœ‰ç®¡ç†å‘˜æ¥å£
- `/api/homework/upload` - ä½œä¸šä¸Šä¼ æ¥å£
- `/api/points/settle` - ç»“ç®—ç›¸å…³æ¥å£
- `/api/points/auto-settlement-*` - è‡ªåŠ¨ç»“ç®—æ¥å£

**å¯ä»¥ç¼“å­˜çš„æ¥å£**:

- `/api/homework/[stageId]` - ä½œä¸šå±•ç¤ºæ¥å£ï¼ˆå»ºè®®5-15åˆ†é’Ÿç¼“å­˜ï¼‰
- `/api/homework/by-user` - ç©å®¶ä½œä¸šåˆ—è¡¨ï¼ˆå»ºè®®10-30åˆ†é’Ÿç¼“å­˜ï¼‰
- `/api/points/leaderboard` - æ’è¡Œæ¦œæ•°æ®ï¼ˆå»ºè®®5-10åˆ†é’Ÿç¼“å­˜ï¼‰
- `/api/points/months` - æœˆä»½åˆ—è¡¨ï¼ˆå»ºè®®30åˆ†é’Ÿç¼“å­˜ï¼‰

**é«˜é¢‘æ¥å£**:

- `/api/cache/get/*` - æ¸¸æˆæ•°æ®ç¼“å­˜ï¼ˆå»ºè®®1å°æ—¶ç¼“å­˜ï¼‰

## ğŸ—„ï¸ æ•°æ®åº“æ¨¡å‹

### UserHomeworkï¼ˆç”¨æˆ·ä½œä¸šï¼‰

- `id`: å”¯ä¸€æ ‡è¯†ç¬¦
- `stageId`: å…³å¡ID
- `nickname`: ç”¨æˆ·æ˜µç§°
- `description`: ä½œä¸šæè¿°
- `teamCount`: é˜Ÿä¼æ•°é‡
- `status`: å®¡æ ¸çŠ¶æ€ï¼ˆpending/approved/rejectedï¼‰
- `createdAt/updatedAt`: æ—¶é—´æˆ³

### HomeworkImageï¼ˆä½œä¸šå›¾ç‰‡ï¼‰

- `id`: å”¯ä¸€æ ‡è¯†ç¬¦
- `homeworkId`: å…³è”ä½œä¸šID
- `filename`: å­˜å‚¨æ–‡ä»¶å
- `originalName`: åŸå§‹æ–‡ä»¶å
- `fileSize`: æ–‡ä»¶å¤§å°
- `order`: å›¾ç‰‡é¡ºåº

### UserPointsï¼ˆç”¨æˆ·ç§¯åˆ†ï¼Œv1.0.0ï¼‰

- `id`: å”¯ä¸€æ ‡è¯†ç¬¦
- `nickname`: ç”¨æˆ·æ˜µç§°
- `yearMonth`: å¹´æœˆæ ‡è¯†ï¼ˆå¦‚ "2025-10"ï¼‰
- `points`: ç´¯è®¡ç§¯åˆ†
- `homeworkCount`: ä½œä¸šæ•°é‡
- `createdAt/updatedAt`: æ—¶é—´æˆ³

### MonthlyPrizePoolï¼ˆæœˆåº¦å¥–æ± ï¼Œv1.0.0ï¼‰

- `id`: å”¯ä¸€æ ‡è¯†ç¬¦
- `yearMonth`: å¹´æœˆæ ‡è¯†
- `basePool`: åŸºç¡€å¥–æ± ï¼ˆé»˜è®¤200ï¼‰
- `carryOver`: ä¸Šæœˆç´¯åŠ 
- `totalPool`: æ€»å¥–æ± 
- `totalPoints`: å½“æœˆæ€»ç§¯åˆ†
- `distributed`: å·²å‘æ”¾å¥–åŠ±
- `nextCarryOver`: ä¸‹æœˆç´¯åŠ 
- `isSettled`: æ˜¯å¦å·²ç»“ç®—
- `settledAt`: ç»“ç®—æ—¶é—´

### PointsHistoryï¼ˆç§¯åˆ†å†å²ï¼Œv1.0.0ï¼‰

- `id`: å”¯ä¸€æ ‡è¯†ç¬¦
- `nickname`: ç”¨æˆ·æ˜µç§°
- `homeworkId`: ä½œä¸šID
- `stageId`: å…³å¡ID
- `teamCount`: é˜Ÿä¼æ•°é‡
- `points`: è·å¾—ç§¯åˆ†
- `isHalved`: æ˜¯å¦å‡åŠ
- `yearMonth`: å¹´æœˆæ ‡è¯†
- `createdAt`: åˆ›å»ºæ—¶é—´

### AutoSettlementConfigï¼ˆè‡ªåŠ¨ç»“ç®—é…ç½®ï¼Œv1.1.0ï¼‰

- `id`: å”¯ä¸€æ ‡è¯†ç¬¦
- `enabled`: æ˜¯å¦å¯ç”¨
- `dayOfMonth`: æ¯æœˆå‡ å·ç»“ç®—ï¼ˆ1-28ï¼‰
- `hour`: ç»“ç®—å°æ—¶ï¼ˆ0-23ï¼‰
- `minute`: ç»“ç®—åˆ†é’Ÿï¼ˆ0-59ï¼‰
- `lastSettledMonth`: ä¸Šæ¬¡ç»“ç®—çš„æœˆä»½
- `createdAt/updatedAt`: æ—¶é—´æˆ³

### SystemConfigï¼ˆç³»ç»Ÿé…ç½®ï¼Œv1.2.2ï¼‰

- `id`: å”¯ä¸€æ ‡è¯†ç¬¦
- `key`: é…ç½®é”®åï¼ˆå”¯ä¸€ï¼‰
- `value`: é…ç½®å€¼
- `description`: é…ç½®è¯´æ˜
- `createdAt/updatedAt`: æ—¶é—´æˆ³

**é¢„å®šä¹‰é…ç½®é¡¹**ï¼š
- `base_prize_pool`: åŸºç¡€å¥–æ± é‡‘é¢ï¼ˆé»˜è®¤200å…ƒï¼‰

### GameDataCacheï¼ˆæ¸¸æˆæ•°æ®ç¼“å­˜ï¼‰

- `id`: å”¯ä¸€æ ‡è¯†ç¬¦
- `dataSource`: æ•°æ®æºï¼ˆlive/reviewï¼‰
- `fileName`: æ•°æ®æ–‡ä»¶å
- `data`: JSONæ ¼å¼çš„æ¸¸æˆæ•°æ®
- `version`: ç¼“å­˜ç‰ˆæœ¬
- `fetchedAt`: æ•°æ®è·å–æ—¶é—´
- `isValid`: æ•°æ®æ˜¯å¦æœ‰æ•ˆ

## ğŸ”§ é…ç½®è¯´æ˜

### ç®¡ç†å‘˜å¯†ç é…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `admin-secret.txt` æ–‡ä»¶ï¼š

```
your_secure_password_here
```

### ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

```env
# æ•°æ®åº“è¿æ¥ï¼ˆé»˜è®¤ä½¿ç”¨ SQLiteï¼‰
DATABASE_URL="file:./dev.db"

# Node ç¯å¢ƒ
NODE_ENV="production"
```

### Next.js é…ç½®

```javascript
// next.config.js
const nextConfig = {
  images: {
    domains: ['raw.githubusercontent.com'], // å¤–éƒ¨å›¾ç‰‡åŸŸå
  },
}
```

## ğŸ® æ ¸å¿ƒåŠŸèƒ½è¯´æ˜

### ç§¯åˆ†æ’è¡Œæ¦œç³»ç»Ÿï¼ˆv1.0.0+ï¼‰

#### ç§¯åˆ†è§„åˆ™

- **19å›¾åŠä»¥ä¸Š**å¯è·å¾—ç§¯åˆ†
- **é˜Ÿä¼ç§¯åˆ†**ï¼šå•é˜Ÿ0.1åˆ†ï¼ŒåŒé˜Ÿ0.5åˆ†ï¼Œä¸‰é˜Ÿ1åˆ†
- **å‡åŠè§„åˆ™**ï¼šå·²æœ‰ä½œä¸šçš„å›¾ï¼Œæ–°ä½œä¸šç§¯åˆ†å‡åŠ

#### å¥–åŠ±å‘æ”¾

- **åŸºç¡€å¥–æ± **ï¼šæ¯æœˆé»˜è®¤200å…ƒï¼ˆå¯åœ¨ç®¡ç†åå°ä¿®æ”¹ï¼‰
- **ç´¯åŠ æœºåˆ¶**ï¼šæœªå‘å®Œçš„å¥–åŠ±å¯ç´¯åŠ åˆ°ä¸‹æœˆï¼ˆä¸å¯è¿ç»­ç´¯åŠ ï¼‰
- **å‘æ”¾è§„åˆ™**ï¼š
  1. æ€»ç§¯åˆ† < åŸºç¡€å¥–æ± ï¼šæŒ‰1:1å‘æ”¾ï¼Œå‰©ä½™ç´¯åŠ 
  2. åŸºç¡€å¥–æ±  â‰¤ æ€»ç§¯åˆ† < æ€»å¥–æ± ï¼šæŒ‰1:1å‘æ”¾
  3. æ€»ç§¯åˆ† â‰¥ æ€»å¥–æ± ï¼šæŒ‰æ¯”ä¾‹åˆ†é…

#### åŸºç¡€å¥–æ± é…ç½®ï¼ˆv1.2.2ï¼‰

ç®¡ç†å‘˜å¯ä»¥åœ¨åå°ä¿®æ”¹æ¯æœˆåŸºç¡€å¥–æ± é‡‘é¢ï¼š

1. ç™»å½•ç®¡ç†åå°ï¼Œè¿›å…¥ã€ŒğŸ’ ç§¯åˆ†ç»“ç®—ã€æ ‡ç­¾é¡µ
2. åœ¨ã€ŒğŸ’° åŸºç¡€å¥–æ± é…ç½®ã€åŒºåŸŸä¿®æ”¹é‡‘é¢
3. ç‚¹å‡»ã€Œä¿å­˜é…ç½®ã€

**æ³¨æ„äº‹é¡¹**ï¼š
- åŸºç¡€å¥–æ± èŒƒå›´ï¼š0-10000å…ƒ
- ä¿®æ”¹åï¼Œæ–°åˆ›å»ºçš„æœˆä»½å°†ä½¿ç”¨æ–°çš„åŸºç¡€é‡‘é¢
- å·²åˆ›å»ºçš„æœˆä»½å¥–æ± ä¸ä¼šè‡ªåŠ¨æ›´æ–°

#### è‡ªåŠ¨ç»“ç®—ï¼ˆv1.1.0 / v1.2.3ï¼‰

**å†…ç½®è‡ªåŠ¨ç»“ç®—æœåŠ¡ï¼ˆv1.2.3ï¼‰**

ç³»ç»Ÿç°å·²å†…ç½®è‡ªåŠ¨ç»“ç®—æœåŠ¡ï¼Œæ— éœ€é…ç½®å¤–éƒ¨å®šæ—¶ä»»åŠ¡ï¼š

1. æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ç»“ç®—æœåŠ¡
2. æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦åˆ°è¾¾ç»“ç®—æ—¶é—´
3. åˆ°è¾¾è®¾å®šæ—¶é—´è‡ªåŠ¨æ‰§è¡Œç»“ç®—

**é…ç½®æ–¹æ³•**ï¼š

1. ç™»å½•ç®¡ç†åå°ï¼Œè¿›å…¥ã€ŒğŸ’ ç§¯åˆ†ç»“ç®—ã€æ ‡ç­¾é¡µ
2. åœ¨ã€Œâ° è‡ªåŠ¨ç»“ç®—é…ç½®ã€åŒºåŸŸè®¾ç½®ï¼š
   - å¯ç”¨/ç¦ç”¨è‡ªåŠ¨ç»“ç®—
   - æ¯æœˆå‡ å·ç»“ç®—ï¼ˆ1-28å·ï¼‰
   - ç»“ç®—æ—¶é—´ï¼ˆå°æ—¶:åˆ†é’Ÿï¼‰
3. ç•Œé¢ä¼šæ˜¾ç¤ºï¼š
   - æœåŠ¡è¿è¡ŒçŠ¶æ€ï¼ˆç»¿è‰²åœ†ç‚¹ = è¿è¡Œä¸­ï¼‰
   - æœåŠ¡å™¨å½“å‰æ—¶é—´
   - è‡ªåŠ¨30ç§’åˆ·æ–°ä¸€æ¬¡

**æ³¨æ„äº‹é¡¹**ï¼š
- æœåŠ¡éšåº”ç”¨å¯åŠ¨è‡ªåŠ¨è¿è¡Œï¼Œæ— éœ€é¢å¤–é…ç½®
- æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼Œç²¾ç¡®åˆ°åˆ†é’Ÿçº§åˆ«
- å»ºè®®è®¾ç½®æ—¶é—´é¿å¼€é«˜å³°æœŸï¼ˆå¦‚å‡Œæ™¨ï¼‰
- ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æŸ¥æ˜¯å¦å·²ç»“ç®—ï¼Œé˜²æ­¢é‡å¤æ‰§è¡Œ

**å¤–éƒ¨å®šæ—¶ä»»åŠ¡ï¼ˆå¯é€‰ï¼Œå…¼å®¹ v1.1.0ï¼‰**ï¼š

å¦‚æœéœ€è¦ä½¿ç”¨å¤–éƒ¨å®šæ—¶ä»»åŠ¡ï¼š
```bash
# æ¯æœˆ1å·0ç‚¹æ‰§è¡Œ
0 0 1 * * curl -X POST https://your-domain.com/api/points/auto-settlement-trigger
```

### ç®¡ç†å‘˜æ‰¹é‡æ“ä½œï¼ˆv1.2.1ï¼‰

- **æ‰¹é‡é€‰æ‹©**ï¼šå¤é€‰æ¡† + å…¨é€‰åŠŸèƒ½
- **æ‰¹é‡é€šè¿‡**ï¼šä¸€æ¬¡æ€§å®¡æ ¸é€šè¿‡å¤šä¸ªä½œä¸š
- **æ‰¹é‡æ‹’ç»**ï¼šä¸€æ¬¡æ€§æ‹’ç»å¤šä¸ªä½œä¸š
- **æ‰¹é‡åˆ é™¤**ï¼šä¸€æ¬¡æ€§åˆ é™¤å¤šä¸ªä½œä¸š
- **æ•ˆç‡æå‡**ï¼šå®¡æ ¸10ä¸ªä½œä¸šä»30æ¬¡æ“ä½œé™è‡³3æ¬¡ï¼ˆæå‡90%+ï¼‰

### ç©å®¶ä½œä¸šæŸ¥çœ‹ï¼ˆv1.2.0ï¼‰

- åœ¨æ’è¡Œæ¦œç‚¹å‡»ç©å®¶æ˜µç§°
- æŸ¥çœ‹è¯¥ç©å®¶æ‰€æœ‰å·²å®¡æ ¸ä½œä¸š
- æŒ‰åŒºåŸŸåˆ†ç»„æ˜¾ç¤º
- æ”¯æŒåˆ†é¡µï¼ˆæ¯é¡µ50ä¸ªï¼‰
- ç‚¹å‡»ä½œä¸šå¡ç‰‡ç›´æ¥è·³è½¬å…³å¡è¯¦æƒ…

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°æ—¥å¿—

### v1.2.3 (2025-10-05)
- âœ… å†…ç½®è‡ªåŠ¨ç»“ç®—æœåŠ¡
- âœ… æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œå®šæ—¶æ£€æŸ¥ï¼ˆæ¯åˆ†é’Ÿï¼‰
- âœ… æ— éœ€é…ç½®å¤–éƒ¨å®šæ—¶ä»»åŠ¡
- âœ… å®æ—¶æ˜¾ç¤ºæœåŠ¡è¿è¡ŒçŠ¶æ€å’ŒæœåŠ¡å™¨æ—¶é—´
- âœ… ç®¡ç†åå°å¯ç›‘æ§è‡ªåŠ¨ç»“ç®—æœåŠ¡çŠ¶æ€

### v1.2.2 (2025-10-05)
- âœ… æ·»åŠ åŸºç¡€å¥–æ± é…ç½®åŠŸèƒ½
- âœ… ç®¡ç†å‘˜å¯è‡ªå®šä¹‰æœˆåº¦åŸºç¡€å¥–æ± é‡‘é¢
- âœ… æ–°å¢SystemConfigç³»ç»Ÿé…ç½®æ¨¡å‹

### v1.2.1 (2025-10-05)
- âœ… ä¿®å¤å›¾ç‰‡é¢„è§ˆæ¨¡æ€æ¡†æ ·å¼
- âœ… æ·»åŠ ç®¡ç†å‘˜æ‰¹é‡æ“ä½œåŠŸèƒ½
- âœ… ä¼˜åŒ–å®¡æ ¸æµç¨‹æ•ˆç‡

### v1.2.0 (2025-10-05)
- âœ… æ·»åŠ ç©å®¶ä½œä¸šæŸ¥çœ‹åŠŸèƒ½
- âœ… æ’è¡Œæ¦œé¡µé¢èƒŒæ™¯å›¾ç‰‡
- âœ… ç®¡ç†å‘˜é¡µé¢è¿”å›ä¸»é¡µæŒ‰é’®
- âœ… ä¿®å¤ä½œä¸šé“¾æ¥è·³è½¬æ ¼å¼

### v1.1.0 (2025-10-05)
- âœ… æ·»åŠ å–æ¶ˆç»“ç®—åŠŸèƒ½
- âœ… æ·»åŠ è‡ªåŠ¨ç»“ç®—é…ç½®
- âœ… æ”¯æŒå®šæ—¶ä»»åŠ¡è§¦å‘ç»“ç®—

### v1.0.0 (2025-10-05)
- âœ… ç§¯åˆ†æ’è¡Œæ¦œç³»ç»Ÿä¸Šçº¿
- âœ… è‡ªåŠ¨ç§¯åˆ†è®¡ç®—
- âœ… æœˆåº¦ç»“ç®—åŠŸèƒ½
- âœ… å¥–æ± ç®¡ç†

### v0.1.0 (åˆå§‹ç‰ˆæœ¬)
- âœ… åŸºç¡€ä½œä¸šä¸Šä¼ å’Œå±•ç¤º
- âœ… ç®¡ç†å‘˜å®¡æ ¸ç³»ç»Ÿ
- âœ… å…³å¡æ•°æ®å±•ç¤º
- âœ… æ•°æ®æºåˆ‡æ¢

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# ç±»å‹æ£€æŸ¥
npm run lint

# æ•°æ®åº“è¿ç§»
npx prisma migrate dev

# é‡æ–°ç”Ÿæˆ Prisma Client
npx prisma generate

# æ•°æ®åº“é‡ç½®ï¼ˆæ…ç”¨ï¼‰
npx prisma db push --force-reset
```

### æ•°æ®åº“ç®¡ç†

```bash
# æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
node scripts/check-db.js

# æ¸…ç†æ•°æ®åº“ï¼ˆVACUUMï¼‰
node scripts/vacuum-db.js

# åˆå§‹åŒ–ç¼“å­˜
node scripts/init-cache.js
```


## ğŸ“ æ”¯æŒä¸åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- GitHub Issues: [æäº¤é—®é¢˜](https://github.com/PackageInstaller/EverSoulHomeWork/issues)

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ LICENSE æ–‡ä»¶ã€‚

---

**Made with â¤ï¸ for EverSoul Community**
